# ??????????? ??????????? ? ????????? ????
entities:
  seaf.ta.components.k8s_namespace:
    presentations:
      table:
        type: table
        headers:
          - value: title
            text: Namespace
            sortable: true
            align: left
            width: 25%
            link: link
          - value: cluster_ref
            text: Кластер
            sortable: true
            align: left
            width: 25%
            link: cluster_link
          - value: labels
            text: Labels
            sortable: false
            align: left
            width: 50%
        source: >
          (
            $refs := $eval($.functions."seaf.ta".get_refs, [{"c":"seaf.ta.components.k8s_namespace"}, $]);
            $get_link := $.functions."seaf.ta".get_link;
            [[$."seaf.ta.components.k8s_namespace".$spread().(
              $COMPONENT_ID := $keys()[0];
              $.*.{
                "title": title,
                "cluster_ref": cluster_ref,
                "labels": $join(labels, ", ") ,
                "cluster_link": $eval($get_link,{"hr":$refs."cluster_ref","val":cluster_ref}),
                "link": '/entities/seaf.ta.components.k8s_namespace/list?ta-component-id=' & $COMPONENT_ID
              }
            )]^(title)]
          )
      list:
        title: K8s Namespace
        params:
          type: object
          properties:
            seaf-ta-component-id:
              title: Идентификатор компонента
              type: string
          required:
            - ta-component-id
        type: markdown
        template: templates/list.md
        source: >
          ( {'title': $self.title, 'id':$params."ta-component-id", "base-name":$split($self."$base", "/")[2]};)

  seaf.ta.components.k8s_node:
    presentations:
      table:
        type: table
        headers:
          - value: title
            text: K8s Узел
            sortable: true
            align: left
            width: 20%
            link: link
          - value: cluster_ref
            text: Кластер
            sortable: true
            align: left
            width: 15%
            link: cluster_link
          - value: version
            text: Версия kubelet
            sortable: true
            align: left
            width: 10%
          - value: architecture
            text: Архитектура CPU
            sortable: true
            align: left
            width: 10%
          - value: cpu
            text: CPU
            sortable: true
            align: left
            width: 10%
          - value: ram
            text: RAM (ГБ)
            sortable: true
            align: left
            width: 10%
          - value: zone
            text: Зона
            sortable: true
            align: left
            width: 10%
          - value: labels
            text: Метки
            sortable: false
            align: left
            width: 15%
        source: >
          (
            $refs := $eval($.functions."seaf.ta".get_refs, [{"c":"seaf.ta.components.k8s_node"}, $]);
            $get_link := $.functions."seaf.ta".get_link;
            [[$."seaf.ta.components.k8s_node".$spread().(
              $COMPONENT_ID := $keys()[0];
              $.*.{
                "title": title,
                "cluster_ref": cluster_ref,
                "version": version,
                "architecture": architecture,
                "cpu": cpu,
                "ram": ram,
                "zone": zone,
                "labels": $join(labels, ", "),
                "cluster_link": $eval($get_link,{"hr":$refs."cluster_ref","val":cluster_ref}),
                "link": '/entities/seaf.ta.components.k8s_node/list?ta-component-id=' & $COMPONENT_ID
              }
            )]^(title)]
          )
      list:
        title: K8s Узел
        params:
          type: object
          properties:
            seaf-ta-component-id:
              title: ????????????? ??????????
              type: string
          required:
            - ta-component-id
        type: markdown
        template: templates/list.md
        source: >
          ( {'title': $self.title, 'id':$params."ta-component-id", "base-name":$split($self."$base", "/")[2]};)
  seaf.ta.components.k8s_deployment:
    presentations:
      table:
        type: table
        headers:
          - value: title
            text: Deployment
            sortable: true
            align: left
            width: 20%
            link: link
          - value: namespace_ref
            text: Namespace
            sortable: true
            align: left
            width: 15%
            link: ns_link
          - value: cluster_ref
            text: Кластер
            sortable: true
            align: left
            width: 15%
            link: cluster_link
          - value: labels
            text: Labels
            sortable: false
            align: left
            width: 20%
          - value: containers
            text: Контейнеры
            sortable: false
            align: left
            width: 30%
        source: >
          (
            $refs := $eval($.functions."seaf.ta".get_refs, [{"c":"seaf.ta.components.k8s_deployment"}, $]);
            $get_link := $.functions."seaf.ta".get_link;
            [[$."seaf.ta.components.k8s_deployment".$spread().(
              $COMPONENT_ID := $keys()[0];
              $containers := ($.containers ? [$.containers] : []);
              $.*.{
                "title": title,
                "namespace_ref": namespace_ref,
                "cluster_ref": cluster_ref,
                "labels": $join(labels, ", "),
                "containers": $join($map(containers, function($v){$v.name & " (" & $v.image & ") CPU=" & $v.resources.limits.cpu & ", RAM=" & $v.resources.limits.ram}), "; ") ,
                "ns_link": $eval($get_link,{"hr":$refs."namespace_ref","val":namespace_ref}),
                "cluster_link": $eval($get_link,{"hr":$refs."cluster_ref","val":cluster_ref}),
                "link": '/entities/seaf.ta.components.k8s_deployment/list?ta-component-id=' & $COMPONENT_ID
              }
            )]^(title)]
          )
      list:
        title: K8s Deployment
        params:
          type: object
          properties:
            seaf-ta-component-id:
              title: Идентификатор компонента
              type: string
          required:
            - ta-component-id
        type: markdown
        template: templates/list.md
        source: >
          ( {'title': $self.title, 'id':$params."ta-component-id", "base-name":$split($self."$base", "/")[2]};)

  seaf.ta.components.k8s_hpa:
    presentations:
      table:
        type: table
        headers:
          - value: title
            text: HPA
            sortable: true
            align: left
            width: 30%
            link: link
          - value: cluster_ref
            text: Кластер
            sortable: true
            align: left
            width: 20%
            link: cluster_link
          - value: min
            text: Min
            sortable: true
            align: left
            width: 10%
          - value: max
            text: Max
            sortable: true
            align: left
            width: 10%
          - value: target_ref
            text: Target
            sortable: true
            align: left
            width: 30%
            link: target_link
        source: >
          (
            $refs := $eval($.functions."seaf.ta".get_refs, [{"c":"seaf.ta.components.k8s_hpa"}, $]);
            $get_link := $.functions."seaf.ta".get_link;
            [[$."seaf.ta.components.k8s_hpa".$spread().(
              $COMPONENT_ID := $keys()[0];
              $.*.{
                "title": title,
                "cluster_ref": cluster_ref,
                "min": min,
                "max": max,
                "target_ref": target_ref,
                "cluster_link": $eval($get_link,{"hr":$refs."cluster_ref","val":cluster_ref}),
                "target_link": $eval($get_link,{"hr":$refs."target_ref","val":target_ref}),
                "link": '/entities/seaf.ta.components.k8s_hpa/list?ta-component-id=' & $COMPONENT_ID
              }
            )]^(title)]
          )
      list:
        title: K8s HPA
        params:
          type: object
          properties:
            seaf-ta-component-id:
              title: Идентификатор компонента
              type: string
          required:
            - ta-component-id
        type: markdown
        template: templates/list.md
        source: >
          ( {'title': $self.title, 'id':$params."ta-component-id", "base-name":$split($self."$base", "/")[2]};)

  seaf.ta.components.server:
    presentations:
      table:
        type: table
        headers:
          - value: fqdn
            text: Имя сервера FQDN
            sortable: true
            align: left
            width: 20%
            link: link

          - value: type
            text: Тип
            sortable: true
            align: left
            width: 20%

          - value: description
            text: Описание
            sortable: true
            align: left
            width: 20%

          - value: location
            text: Размещение
            sortable: true
            align: left
            width: 20%
            link: dc_link

          - value: virtualization
            text: Среда виртуализации
            sortable: true
            align: left
            width: 20%
            link: dc_link

        source: >
          (
            $refs := $eval($.functions."seaf.ta".get_refs, [{"c":"seaf.ta.components.server"}, $]);
            $get_link := $.functions."seaf.ta".get_link;
            [[$."seaf.ta.components.server".$spread().(
             $COMPONENT_ID := $keys()[0]; 
             $.*.{
                "title": title,
                "description": description,
                "type": type,      
                "location": location,
                "virtualization": virtualization,
                "fqdn": fqdn,
                "link": '/entities/seaf.ta.components.server/list?ta-component-id=' & $COMPONENT_ID,
                "dc_link" :  $eval($get_link,{"hr":$refs."dc","val":dc})
              }
            )]^(title)]
          )
          

      list:
        title: Перечень компонент
        params:
          type: object
          properties:
            seaf-ta-component-id:
              title: Идентификатор компонента
              type: string
          required:
            - ta-component-id
        type: markdown
        template: templates/list.md
        source: >
          ({'title': $self.title, 'id':$params."ta-component-id", "base-name":$split($self."$base", "/")[2]};)

  seaf.ta.components.hw_storage:
    presentations:
      table:
        type: table
        headers:
          - value: title
            text: Наименование
            sortable: true
            align: left
            width: 20%
            link: link

          - value: description
            text: Описание
            sortable: true
            align: left
            width: 20%

          - value: vendor
            text: Производитель
            sortable: true
            align: left
            width: 20%

          - value: location
            text: Размещение
            sortable: true
            align: left
            width: 20%


        source: >
          (
            $refs := $eval($.functions."seaf.ta".get_refs, [{"c":"seaf.ta.components.hw_storage"}, $]); 
            $get_link := $.functions."seaf.ta".get_link;
            [[$."seaf.ta.components.hw_storage".$spread().(
              $COMPONENT_ID := $keys()[0];
             $.*.{
                "title": title,
                "description": description,
                "vendor": vendor,
                "location": location,
                "link": '/entities/seaf.ta.components.hw_storage/list?ta-component-id=' & $COMPONENT_ID,
                "dc_link" :  $eval($get_link,{"hr":$refs."dc_id","val":dc_id})
              }
            )]^(title)]
          )
          
          

      list:
        title: Перечень компонент аппаратного хранения данных
        params:
          type: object
          properties:
            seaf-ta-component-id:
              title: Идентификатор компонента
              type: string
          required:
            - ta-component-id
        type: markdown
        template: templates/list.md
        source: >
          ( {'title': $self.title, 'id':$params."ta-component-id", "base-name":$split($self."$base", "/")[2]};)

  seaf.ta.components.network:
    presentations:
      table:
        type: table
        headers:
          - value: title
            text: Наименование
            sortable: true
            align: left
            width: 20%
            link: link

          - value: ip
            text: IP адрес
            sortable: true
            align: left
            width: 20%

          - value: description
            text: Описание
            sortable: true
            align: left
            width: 20%

          - value: location
            text: Размещение
            sortable: true
            align: left
            width: 20%


        source: >
          (
            $refs := $eval($.functions."seaf.ta".get_refs, [{"c":"seaf.ta.components.network"}, $]);
            $get_link := $.functions."seaf.ta".get_link;
            [[$."seaf.ta.components.network".$spread().(
              $COMPONENT_ID := $keys()[0];
             $.*.{
                "title": title,
                "description": description,
                "location": location,
                "ip": address,
                "model": model,
                "link": '/entities/seaf.ta.components.network/list?ta-component-id=' & $COMPONENT_ID,
                "dc_link" :  $eval($get_link,{"hr":$refs."dc_id","val":dc_id})
              }
            )]^(title)]
          )
          

      list:
        title: Перечень сетевых устройств
        params:
          type: object
          properties:
            seaf-ta-component-id:
              title: Идентификатор компонента
              type: string
          required:
            - ta-component-id
        type: markdown
        template: templates/list.md
        source: >
          ( {'title': $self.title, 'id':$params."ta-component-id", "base-name":$split($self."$base", "/")[2]};)

  seaf.ta.components.user_device:
    presentations:
      table:
        type: table
        headers:
          - value: title
            text: Наименование
            sortable: true
            align: left
            width: 20%
            link: link

          - value: description
            text: Описание
            sortable: true
            align: left
            width: 20%

          - value: device_type
            text: Тип пользовательского устройства
            sortable: true
            align: left
            width: 20%


        source: >
          (
            [[$."seaf.ta.components.user_device".$spread().(
              $COMPONENT_ID := $keys()[0];
             $.*.{
                "title": title,
                "description": description,
                "device_type": device_type,    
                "link": '/entities/seaf.ta.components.user_device/list?ta-component-id=' & $COMPONENT_ID
              }
            )]^(title)]
          )
      list:
        title: Перечень пользовательских устройств
        params:
          type: object
          properties:
            seaf-ta-component-id:
              title: Идентификатор компонента
              type: string
          required:
            - ta-component-id
        type: markdown
        template: templates/list.md
        source: >
          ( {'title': $self.title, 'id':$params."ta-component-id", "base-name":$split($self."$base", "/")[2]};)
