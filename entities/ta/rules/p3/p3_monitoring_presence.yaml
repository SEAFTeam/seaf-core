rules:
  validators:
    seaf.validation.ta.p3.monitoring_presence:
      uid: SEAF-TA-P3-MON-PRESENCE
      title: "[TACSA_4-P3-36-04 (частично)] Наличие сервиса мониторинга"
      description: |
        Частичная проверка наличия централизованного мониторинга: проверяется существование
        хотя бы одного объекта `seaf.ta.services.monitoring`.
        Требование (частично): TACSA_4-P3-36-04 — Централизованный сбор и хранение телеметрии/логов для анализа и расследований.
        
        Требование (цитата):
        Инфраструктурные сервисы платформы контейнерной оркестрации (системные компоненты кластера) должны быть размещены на отдельных выделенных узлах кластера, которые не используются для размещения пользовательских приложений.
      correction: |
        Добавьте описание сервиса мониторинга в модель (`seaf.ta.services.monitoring`).
      source: |
        ([
          (
            $req := "Инфраструктурные сервисы платформы контейнерной оркестрации (системные компоненты кластера) должны быть размещены на отдельных выделенных узлах кластера, которые не используются для размещения пользовательских приложений.";
            $code := "TACSA_4-P3-36-04";
            $mon := $."seaf.ta.services.monitoring";
            ($not($exists($mon)) or $count($keys($mon)) = 0) ? {
              "uid": "seaf.validation.ta.p3.monitoring_presence.absent",
              "deviation_id": $code & ":" & "seaf.validation.ta.p3.monitoring_presence.absent",
              "title": "Отсутствует сервис мониторинга",
              "correction": "Опишите сервис мониторинга в разделе services",
              "description": "В модели не найден seaf.ta.services.monitoring\n\nТребование (цитата):\n" & $req
            }
          )
        ])
